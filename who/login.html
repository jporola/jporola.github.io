<!DOCTYPE html>
<html>
    <head>
        <title>Who art thou?</title>

        <link rel="stylesheet" href="main.css" />
    </head>
    <body>
        <p id="error"></p>

        <form name="login" action="return false;" method="POST">
            <input type="email" name="email" placeholder="email" required />
            <input type="password" name="password" placeholder="password" required />
            <input type="submit" name="submit" value="login" disabled="disabled" />
        </form>

        <script type="module">
            import * as api from './api.js';
            import * as dom from './domUtils.js';

            const setError = (text) => { dom.setText('error', text); }

            const login = async (event) => {
                event.preventDefault()

                setError('');

                try {
                    await api.login(event.srcElement.email.value, event.srcElement.password.value);
                    location.replace('./');
                } catch(error) {
                    console.error(error);
                    setError(error.message);
                }
            }
            document.forms.login.addEventListener('submit', login);
            document.forms.login.elements.submit.disabled = false;
        </script>
    </body>
</html>
